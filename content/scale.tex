Obwohl Spectrum Scale eigentlich dafür vorgesehen ist, auf multiplen Systemen installiert zu werden, ist es möglich ein minimales Setup mit zwei oder auch nur einer Maschine zu ermöglichen. Speziell für letzteren Fall gibt es ein von IBM zur Verfügung gestelltes Demoabbild.

Dies ist für ein Produktivsystem absolut nicht zu empfehlen, da aufgrund der verteilten Architektur von Scale ein hoher Leistungsmehraufwand auf einem einzelnen Rechner entsteht und kein Gewinn aus parallelem Dateizugriff gezogen werden kann.

Für diese Arbeit wird ein vorbereitetes Abbild verwendet, das bereits eine ältere Version von Cloud Tiering unterstützt.

\textbf{Vorbereitung der Host Maschine}\\
Im ersten Schritt muss auf dem zu verwendenden Rechner eine Virtualisierungslösung installiert werden. Es wurde sich hierbei für \ac{KVM} im Zusammenspiel mit \ac{QEMU} entschieden, da diese kostenlos verwendbar und in Linux integriert sind. 

Bei QEMU handelt es sich um einen Open Source virtuelle Maschinen Emulator und Virtualisierer mit nur geringem Leistungsverlust für das Gastsystem. Volle Virtualisierung durch direktes Ausführen der Gastbefehle auf der Gastgeber CPU kann aber nur in Zusammenarbeit mit einem Xen Hypervisor oder mit dem KVM Kernel Modul auf Linux Systemen erreicht werden \parencite{qemu.2017}. 
KVM ermöglicht Virtualisierung mithilfe von Intel/Amd CPUs der x86 Bauart, die so genannte virtuelle Erweiterungen zur Verfügung stellen. Es besteht aus einem ladbaren Kernel Modul, das eine grundsätzliche Infrastruktur für genannte Aufgaben zur Verfügung stellt \parencite{kvm.2017}.
Zusätzlich wird das Tool \textit{Virtual Manager} verwendet, das eine grafische Oberfläche für die \acs{VM}s zur Verfügung stellt.

Die komplette relevante Software ist über gebräuchliche Paketverwaltungssysteme verfügbar (Advanced Packaging Tool, Red Hat Package Manager). Eine beispielhafte Installation für Red Hat Linux, laufend auf einer x86 Intel CPU, kann so aussehen (Ein laufendes System mit installiertem X Server wird vorausgesetzt):\\ 

\begin{lstlisting}[language=bash, caption=Einrichtung von KVM und QEMU]
[root@host ~]# grep -E '(vmx|svm)' /proc/cpuinfo 

[root@host ~]# yum update
[root@host ~]# yum install qemu-kvm qemu-img virt-manager libvirt libvirt-python libvirt-client virt-install virt-viewer bridge-utils

[root@host ~]# systemctl start libvirtd
[root@host ~]# systemctl enable libvirtd

[root@host ~]# lsmod | grep kvm
kvm_intel             162153  0
kvm                   525409  1 kvm_intel
\end{lstlisting} 

Im obigen Beispiel wird zuerst überprüft, ob das System Hardware Virtualisierung unterstützt. Falls diese nicht vorhanden ist, kann KVM nicht verwendet werden, was zu einer massiven Verschlechterung der Leistung der VM führt.
Im nächsten Schritt wird zuerst die Paketliste aktualisiert, dann die notwendige Software installiert und ihr Service gestartet. Als letztes überprüft man, ob das KVM Module richtig geladen wurde, der Output zeigt das geladene Modul für Intel CPUs.

\textbf{Installation des Spectrum Scale Probeabbilds}\\
Das Probeabbild ist zum leichteren Umgang in vier einzelne .img Abbilder aufgeteilt worden. Zusätzlich hierzu gibt es drei XML Dateien, die zur Konfiguration der VM und der Einrichtung von notwendigen privaten Netzwerken dienen.

Das erste virtuelle Netzwerk reicht von 10.0.2.1 zu 10.0.2.254 und wird für die Kommunikation des \acs{NSD} Servers und des Daemon von Spectrum Scale benutzt. Das zweite (192.168.56.1 bis 192.168.56.254) wird verwendet, um das Administrations UI über das Web erreichbar zu machen.

Bei der Konfigurationsdatei für die VM (SpectrumScale423\_TrialVM\_TCT.xml) muss Imagedateipfad und die Bezeichnung der Maschine (auslesbar durch \textit{virsh capabilities}) angepasst werden, da diese OS spezifisch abweichen können. Die XML Dateien der virtuellen Netzwerke müssen nur angepasst werden, wenn die festgelegten IDs auf dem System bereits existieren: \\

\begin{lstlisting}[language=xml, caption=Veränderung der relevanten XML Konfiguration]
<domain type='kvm' xmlns:qemu='http://libvirt.org/schemas/domain/qemu/1.0'>
	<name>SpectrumScale423_TrialVM_TCT</name>
	...
	<os>
		<type arch='x86_64' machine='(*@\colorbox{yellow}{pc-i440fx-rhel7.0.0}@*)'>hvm</type> 
		<boot dev='hd'/>
	</os>
	...
	<devices>
		<emulator>/usr/libexec/qemu-kvm</emulator>
		<disk type='file' device='disk'>
			<driver name='qemu' type='raw'/>
			<source file='(*@\colorbox{yellow}{/home/simon/images/SpectrumScale421\_TrialVM-disk1.img}@*)'/>
			<target dev='hda' bus='ide'/>
			<address type='drive' controller='0' bus='0' target='0' unit='0'/>
		</disk>
		<disk type='file' device='disk'>
			<source file='(*@\colorbox{yellow}{/home/simon/images/SpectrumScale421\_TrialVM-disk2.img}@*)'/>
			...
		</disk>
		<disk type='file' device='disk'>
			<source file='(*@\colorbox{yellow}{/home/simon/images/SpectrumScale421\_TrialVM-disk3.img}@*)'/>
			...
		</disk>
		<disk type='file' device='disk'>
			<source file='(*@\colorbox{yellow}{/home/simon/images/SpectrumScale421\_TrialVM-disk4.img}@*)'/>
			...
		</disk>
	...
	</devices>
...
\end{lstlisting}

Diese grundsätzlicmhe Konfiguration nach individueller Anpassung kann wieder über diverse Bash Eingaben automatisiert werden: \\

\begin{lstlisting}[language=bash, caption=Portierung des VM Abbilds]
[root@host ~]# mkdir images && mv <your image files and xml configuration> images
[root@host ~]# virsh define SpectrumScale423_TrialVM_TCT.xml 

[root@host ~]# virsh net-define SpectrumScale_network1.xml
[root@host ~]# virsh net-define SpectrumScale_network2.xml

[root@host ~]# virt-manager
\end{lstlisting}

Die VM ist nun nach dem ersten Start vollständig aufgesetzt und die Administrationsoberfläche über die IP 192.168.56.101 zugänglich.

\textbf{Update des Spectrum Scale Systems}\\
Nach ersten Versuchen mit dem Spectrum Scale System Version 4.2.2.1 hat sich herausgestellt, dass das Cloud Tiering Feature nicht mit der öffentlichen Version von \acs{COS} kommunizieren kann. Die Verbindung kommt nicht zustande, da keine abweichende Endpunkt URL angenommen wird.

Deswegen muss zuerst die Version 4.2.3.1 installiert werden, um unser Hybrid Cloud Setup zu ermöglichen. Bei Spectrum Scale geschieht dies normalerweise ausgehend von einem Administrationsknoten, der dann die Updates über das gesamte Netz verteilt. Die Patchdatei wird mithilfe von \ac{SCP} von der Hostmaschine auf das, in dieser Konstellation bestehende, Gastsystem kopiert.	

Dort kann sie ausgeführt werden, wodurch sich das Installationstool \textit{spectrumscale} installiert. Nachdem man in diesem die Adressen der Knoten (hier der eigene), kann die Aktualisierung gestartet werden. Das Werkzeug ist hierbei selbst erklärend und führt durch die einzelnen Schritte, es werden auch entsprechende Hinweise für fehlende Konfigurationseingaben gegeben.
Im Laufe von dieser müssen eventuell der Cloud Service manuell gestoppt werden, sofern eine entsprechende Fehlermeldung angezeigt wird.

Nach erfolgreichen Update kann nun die Cloud Funktionalität konfiguriert werden.

\textbf{Installation Transparent Cloud Tiering}\\

Eine ausführliche Anleitung zum Installieren von Cloud Tiering Knoten auf einer einfachen Installation von Spectrum Scale ist in dieser Quelle beschrieben: \cite{mani.2017}.

In diesem Anwendungsfall ist die Installation nicht notwendig. Auf den eingerichteten VM-Abbildern ist der Clouddienst bereits funktionsfähig.

